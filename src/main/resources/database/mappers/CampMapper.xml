<?xml version="1.0" encoding="UTF-8"?>
<!-- Schema 추가 -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

  <mapper namespace="com.camp.s1.camping.CampDAO">
  
    <!-- 공통부분 - 검색 -->
  	<sql id="searchCondition">
  		<where>
  			<!-- CAMPNUM = #{campNum} AND / site 옵션 쓸 때 써야함-->
	  		<if test="kind=='name'">
	  			NAME LIKE '%' || #{search} || '%'
	  		</if>
			<if test="kind=='phone'">
	  			PHONE LIKE '%' || #{search} || '%'
	  		</if>
	  		<if test="kind=='address'">
	  			ADDRESS LIKE '%' || #{search} || '%'
	  		</if>
	  		<if test="kind=='contents'">
	  			CONTENTS LIKE '%' || #{search} || '%'
	  		</if>
  		</where>
  	</sql>
  	
  	
  	<!-- totalCount - calculate row of Pager -->
  	<select id="getTotalCount" parameterType="Pager" resultType="Long">
  		SELECT COUNT(CAMPNUM) FROM CAMPINFO
  		<include refid="searchCondition"></include>
  	</select>
  
  	<!-- list -->
  	<select id="getCampList" parameterType="Pager" resultType="CampDTO">
  		<!-- SELECT * FROM CAMPINFO ORDER BY CAMPNUM DESC -->
  		SELECT * FROM
			(SELECT ROWNUM R, C.* FROM
				(SELECT * FROM CAMPINFO
				<include refid="searchCondition"></include>
			ORDER BY CAMPNUM DESC) C)
		WHERE R BETWEEN #{startRow} AND #{lastRow}  		
  	</select>
  
  	<!-- detail -->
  	<select id="getCampDetail" parameterType="CampDTO" resultType="CampDTO">
  		SELECT * FROM CAMPINFO
  		WHERE CAMPNUM=#{campNum}
  	</select>
  
	<!-- add -->
	<insert id="setCampAdd" parameterType="CampDTO">
		<selectKey keyProperty="campNum" order="BEFORE" resultType="Long">
			SELECT CAMPSEQ.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO CAMPINFO(CAMPNUM, NAME, PHONE, ADDRESS, CONTENTS)
		VALUES(#{campNum}, #{name}, #{phone}, #{address}, #{contents})
	</insert>
	
	<!-- delete -->
	<delete id="setCampDelete" parameterType="CampDTO">
		DELETE CAMPINFO WHERE CAMPNUM=#{campNum}
	</delete>
	
	<!-- update -->
	<update id="setCampUpdate" parameterType="CampDTO">
		UPDATE CAMPINFO SET NAME=#{name}, PHONE=#{phone}, ADDRESS=#{address}, CONTENTS=#{contents}
		WHERE CAMPNUM=#{campNum}
	</update>
  
  
  
  </mapper>