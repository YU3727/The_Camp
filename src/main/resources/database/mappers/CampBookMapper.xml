<?xml version="1.0" encoding="UTF-8"?>
<!-- Schema 추가 -->
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"https://mybatis.org/dtd/mybatis-3-mapper.dtd">

	<mapper namespace="com.camp.s1.camping.book.CampBookDAO">
	
	
	<!-- siteList -->
	<select id="getCampSiteList" parameterType="CampDTO" resultType="CampSiteDTO">
		SELECT * FROM CAMPSITE WHERE CAMPNUM=#{campNum}
	</select>
	
	<!-- siteDetail -->
	<select id="getCampSiteDetail" parameterType="Long" resultType="CampSiteDTO">
		SELECT * FROM CAMPSITE WHERE AREANUM=#{areaNum}
	</select>
	
	<!-- bookAdd -->
	<insert id="setCampBookAdd" parameterType="CampBookDTO">
		<selectKey keyProperty="num" order="BEFORE" resultType="Long">
			SELECT CAMPSEQ.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO CAMPBOOK(NUM, AREANUM, ID, INDEXCODE, ORDERNUM, PRICE, REGDATE, STARTDATE, LASTDATE, ACCOUNT, DAYINFO, STATUS)
		VALUES(#{num}, #{areaNum}, #{id}, #{indexCode}, #{orderNum}, #{price}, sysdate, #{startDate}, #{lastDate}, #{account}, #{dayInfo}, '입금대기')
	</insert>
	
	<!-- getOrderNum -->
	<select id="getOrderNumber" resultType="Long">
		SELECT PAYMENTSEQ.NEXTVAL FROM DUAL
	</select>
	
	<!-- setOrderNum -->
	<insert id="setOrderNumber" parameterType="CampBookDTO">
		INSERT INTO ORDERS(ORDERNUM)
		VALUES(#{orderNum})
	</insert>
	
	<!-- getDayOfWeek -->
	<select id="getDayOfWeek" parameterType="CampSiteDTO" resultType="Long">
		SELECT TO_CHAR(startDate + LEVEL-1, 'd') AS dayOfWeek
			FROM 
				(SELECT  TO_DATE(#{startDate}, 'YYYY-MM-DD') AS startDate
						, TO_DATE(#{lastDate}, 'YYYY-MM-DD') AS lastDate
			FROM DUAL)
		<![CDATA[CONNECT BY LEVEL <= lastDate - startDate]]>
	</select>
	
	
	</mapper>