<?xml version="1.0" encoding="UTF-8"?>
<!-- Schema 추가 -->
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"https://mybatis.org/dtd/mybatis-3-mapper.dtd">

	<mapper namespace="com.camp.s1.camping.book.CampBookDAO">
	
	
	<!-- siteList -->
	<select id="getCampSiteList" parameterType="CampDTO" resultType="CampSiteDTO">
		SELECT * FROM CAMPSITE WHERE CAMPNUM=#{campNum}
	</select>
	
	<!-- siteDetail -->
	<select id="getCampSiteDetail" parameterType="Long" resultType="CampSiteDTO">
		SELECT * FROM CAMPSITE WHERE AREANUM=#{areaNum}
	</select>
	
	<!-- bookAdd -->
	<insert id="setCampBookAdd" parameterType="CampBookDTO">
		<selectKey keyProperty="num" order="BEFORE" resultType="Long">
			SELECT CAMPSEQ.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO CAMPBOOK(NUM, AREANUM, ID, INDEXCODE, ORDERNUM, PRICE, REGDATE, STARTDATE, LASTDATE, ACCOUNT, STATUS)
		VALUES(#{num}, #{areaNum}, #{id}, #{indexCode}, #{orderNum}, #{price}, sysdate, #{startDate}, #{lastDate}, #{account}, '입금대기')
	</insert>
	
	<!-- getOrderNum -->
	<select id="getOrderNumber" resultType="Long">
		SELECT PAYMENTSEQ.NEXTVAL FROM DUAL
	</select>
	
	<!-- setOrderNum -->
	<insert id="setOrderNumber" parameterType="CampBookDTO">
		INSERT INTO ORDERS(ORDERNUM)
		VALUES(#{orderNum})
	</insert>
	
	<!-- getMemberDetail -->
	<select id="getMemberDetail" parameterType="MemberDTO" resultType="MemberDTO">
		SELECT * FROM MEMBER WHERE ID=#{id}
	</select>
	
	<!-- getCampBookList -->
	<select id="getCampBookList" parameterType="Long" resultType="CampBookDTO">
		<!-- SELECT CI.CAMPNUM, CS.SITENAME, CS.SITESIZE, CS.STATUS, CB.ID, CB.ORDERNUM, CB.PRICE, CB.STARTDATE, CB.LASTDATE, CB.STATUS -->
		SELECT *
		FROM CAMPBOOK CB
			LEFT OUTER JOIN
			CAMPSITE CS
			ON(CB.AREANUM=CS.AREANUM)
			LEFT OUTER JOIN
			CAMPINFO CI
			ON(CS.CAMPNUM=CI.CAMPNUM)
		WHERE CI.CAMPNUM=#{campNum}
		
		
		<!-- FROM CAMPINFO CI
			JOIN CAMPSITE CS
			ON(CI.CAMPNUM = CS.CAMPNUM)
			JOIN CAMPBOOK CB
			ON(CS.AREANUM = CB.AREANUM)
		WHERE CI.CAMPNUM = #{campNum} -->
	</select>
	
	
	
	</mapper>